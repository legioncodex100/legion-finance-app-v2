---
name: commenting-docs
description: Documentation and commenting guidelines for Legion Finance. Use when writing comments, documenting functions, or updating README files. Focus on explaining WHY, not WHAT.
---

# Commenting & Documentation Skill

## When to Use
- Writing inline comments
- Documenting complex functions
- Updating project documentation
- Onboarding new developers

## The Golden Rule

**Comments explain WHY, not WHAT**

```typescript
// ❌ BAD: Explains what (obvious from code)
// Loop through payables
for (const payable of payables) { ... }

// Increment counter
count++

// Check if paid
if (isPaid) { ... }

// ✅ GOOD: Explains why (not obvious)
// Skip first-of-month bills since they're generated by a separate cron job
for (const payable of payables.filter(p => p.day_of_month !== 1)) { ... }

// Account for £0.20 per-transaction fee that Stripe charges
count += transactionCount * 0.20

// MB marks failed payments as "Approved (Voided)" - exclude from revenue
if (status !== 'Approved (Voided)') { ... }
```

## Function Documentation

Use JSDoc for complex functions:

```typescript
/**
 * Generates bills for all recurring templates for a given month.
 * Weekly templates create 4-5 bills (one per Friday).
 * Monthly/quarterly/yearly create one bill per period.
 * 
 * @param month - 0-indexed month (0 = January)
 * @param year - Full year (e.g., 2026)
 * @returns Number of bills generated
 * 
 * @example
 * await generateUpcomingBills(0, 2026) // January 2026
 */
export async function generateUpcomingBills(month: number, year: number): Promise<number> {
    // ...
}
```

## When to Comment

| Situation | Comment? | Example |
|-----------|----------|---------|
| Non-obvious business logic | ✅ Yes | `// Fridays are payday at Legion` |
| Workaround for bug/limitation | ✅ Yes | `// TODO: Remove after MB API v2` |
| Complex algorithm | ✅ Yes | Explain the approach |
| API quirk | ✅ Yes | `// MB uses request. prefix` |
| Simple CRUD operation | ❌ No | Code is self-explanatory |
| Standard patterns | ❌ No | Everyone knows React hooks |

## TODO Comments

Use consistent format for tracking:

```typescript
// TODO: Implement pagination when member count exceeds 1000
// FIXME: Balance shows 0 when Starling API fails
// HACK: Workaround for Mindbody API date format bug
// NOTE: This runs on Fridays via Vercel cron
```

## Section Comments

Break up long files with section headers:

```typescript
// =====================
// State & Hooks
// =====================
const [payables, setPayables] = useState<Payable[]>([])
...

// =====================
// Data Fetching
// =====================
const fetchData = async () => { ... }
...

// =====================
// Event Handlers
// =====================
const handleSubmit = () => { ... }
...

// =====================
// Render
// =====================
return (
    ...
)
```

## README Pattern

Every major feature should have context in `docs/memory.md`:

```markdown
## Accounts Payable

### Overview
- Manages bills, recurring payments, and staff salaries
- Links bills to bank transactions for reconciliation
- Supports partial payments

### Key Decisions
- Weekly bills generate for Fridays (Legion payday)
- Templates use `is_template: true` flag
- `amount_paid` tracks partial payments

### Known Issues
- None currently

### Related Files
- `src/lib/actions/payables.ts`
- `src/app/(dashboard)/accounts-payable/page.tsx`
```

## Changelog in Development Log

Document significant changes in `docs/memory.md`:

```markdown
## January 2026

### January 14 - Bill Improvements
- Added bulk delete with checkboxes
- Added search and sortable columns
- Fixed weekly bill generation (4-5 Fridays per month)
- Added partial payment support with progress bar
```

## What NOT to Comment

```typescript
// ❌ Don't comment obvious code
const name = payable.name  // Get the payable name
setIsLoading(true)  // Set loading to true
return data  // Return the data

// ❌ Don't leave commented-out code
// const oldLogic = () => { ... }

// ❌ Don't write novel-length comments
// Instead, refactor the code to be clearer
```
